{% extends "base.html" %}

{% block head %}
  {% if is_download %}
    <link rel="stylesheet" href="file:///{{ css_path | replace('\\', '/') }}">
  {% else %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/' + resume.style + '.css') }}">
  {% endif %}
{% endblock %}

{% block body %}
<div class="resume-container">
  <div class="left-panel">
    <div class="profile-pic-wrapper">
      {% if is_download %}
        <img src="file:///{{ static_image_path | replace('\\', '/') }}" alt="Profile Picture" class="profile-pic">
      {% elif info.profile_pic and info.profile_pic != 'default.jpg' %}
        <img src="{{ url_for('static', filename='uploads/' + info.profile_pic) }}" alt="Profile Picture" class="profile-pic">
      {% else %}
        <img src="{{ url_for('static', filename='uploads/default.jpg') }}" alt="Default Profile Picture" class="profile-pic">
      {% endif %}
    </div>

    <div class="header-info">
      <h1 class="name">{{ info.full_name }}</h1>
    </div>

    <div class="contact-info">
      {% if info.resume_email %}
        <p class="contact-item">
          <strong>Email:</strong><br>
          <a href="mailto:{{ info.resume_email }}">{{ info.resume_email }}</a>
        </p>
      {% endif %}
      
      {% if info.phone %}
        <p class="contact-item">
          <strong>Phone:</strong><br>
          {{ info.phone }}
        </p>
      {% endif %}
      
      {% if info.github %}
        <p class="contact-item">
          <strong>GitHub:</strong><br>
          <a href="{{ info.github }}" target="_blank">{{ info.github }}</a>
        </p>
      {% endif %}
      
      {% if info.linkedin %}
        <p class="contact-item">
          <strong>LinkedIn:</strong><br>
          <a href="{{ info.linkedin }}" target="_blank">{{ info.linkedin }}</a>
        </p>
      {% endif %}
    </div>

    {% if skills %}
      <div class="sidebar-section">
        <h3 class="sidebar-title">Skills</h3>
        <ul class="skills-list">
          {% for skill in skills %}
            <li class="skill-item">
              <span class="skill-name">{{ skill.name }}</span>
              <span class="skill-badge">{{ skill.level | capitalize }}</span>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  </div>

  <div class="right-panel">
    {% if info.summary %}
      <section class="resume-section">
        <h2 class="section-title">Professional Summary</h2>
        <div class="section-content">
          <p>{{ info.summary }}</p>
        </div>
      </section>
    {% endif %}

    {% if educations %}
      <section class="resume-section">
        <h2 class="section-title">Education</h2>
        {% for edu in educations %}
          <div class="section-item">
            <div class="item-header">
              <h3 class="item-title">{{ edu.degree }}{% if edu.institution %} - {{ edu.institution }}{% endif %}</h3>
              {% if edu.start_year or edu.end_year %}
                <span class="item-date">{{ edu.start_year }}{% if edu.end_year %} - {{ edu.end_year }}{% endif %}</span>
              {% endif %}
            </div>
            {% if edu.description %}
              <p class="item-description">{{ edu.description }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </section>
    {% endif %}

    {% if experiences %}
      <section class="resume-section">
        <h2 class="section-title">Experience</h2>
        {% for exp in experiences %}
          <div class="section-item">
            <div class="item-header">
              <h3 class="item-title">{{ exp.job_title }}{% if exp.company %} at {{ exp.company }}{% endif %}</h3>
              {% if exp.start_date or exp.end_date %}
                <span class="item-date">{{ exp.start_date }}{% if exp.end_date %} - {{ exp.end_date }}{% endif %}</span>
              {% endif %}
            </div>
            {% if exp.description %}
              <p class="item-description">{{ exp.description }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </section>
    {% endif %}

    {% if projects %}
      <section class="resume-section">
        <h2 class="section-title">Projects</h2>
        {% for proj in projects %}
          <div class="section-item">
            <div class="item-header">
              <h3 class="item-title">{{ proj.title }}</h3>
              {% if proj.link %}
                <a href="{{ proj.link }}" class="item-link" target="_blank">View</a>
              {% endif %}
            </div>
            {% if proj.description %}
              <p class="item-description">{{ proj.description }}</p>
            {% endif %}
            {% if proj.tech_stack %}
              <p class="tech-stack"><strong>Tech Stack:</strong> {{ proj.tech_stack }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </section>
    {% endif %}

    {% if certifications %}
      <section class="resume-section">
        <h2 class="section-title">Certifications</h2>
        {% for cert in certifications %}
          <div class="section-item">
            <div class="item-header">
              <h3 class="item-title">{{ cert.name }}</h3>
              {% if cert.issue_date %}
                <span class="item-date">{{ cert.issue_date }}</span>
              {% endif %}
            </div>
            {% if cert.issuer %}
              <p class="item-description"><strong>Issued by:</strong> {{ cert.issuer }}</p>
            {% endif %}
            {% if cert.credential_link %}
              <p class="item-description"><a href="{{ cert.credential_link }}" target="_blank">View Credential</a></p>
            {% endif %}
          </div>
        {% endfor %}
      </section>
    {% endif %}
  </div>
</div>

{% if not is_download %}
  <div class="resume-actions">
    <a href="{{ url_for('views.create_resume', resume_id=resume.id) }}" class="btn-secondary">Edit Resume</a>
    <a href="{{ url_for('views.download_resume', resume_id=resume.id) }}" id="downloadBtn" class="btn-primary download-btn">Download PDF</a>
    <a href="{{ url_for('views.manage_resumes') }}" class="btn-secondary">Back to Resumes</a>
  </div>
  <script>
    const downloadBtn = document.getElementById('downloadBtn');
    if (downloadBtn) {
      downloadBtn.addEventListener('click', function() {
        this.style.animation = 'pulse 0.6s ease-in-out';
        const originalText = this.textContent;
        this.textContent = 'â¬‡ Downloading...';
        setTimeout(() => {
          this.style.animation = '';
          this.textContent = originalText;
        }, 2000);
      });
    }
  </script>
{% endif %}
{% endblock %}
